{% extends 'technician_pages/technician_dashboard.html' %}
{% block title %}Notifications{% endblock %}
{% block content %}
<h1>Notifications</h1>

<style>
  /* Notification List */
  .notifications-list {
    list-style: none;
    padding: 0;
    margin-top: 20px;
  }

  .notification-item {
    background: #f9f9f9;
    padding: 15px;
    margin-bottom: 12px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    transition: background 0.3s;
    box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    cursor: pointer;
  }

  .notification-item:hover {
    background: #eef2ff;
  }

  .notification-message {
    font-size: 15px;
    color: #010A28;
  }

  .notification-time {
    font-size: 13px;
    color: #888;
    margin-left: 10px;
  }

  /* Modal Styles */
  .modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow-y: auto;
    background-color: rgba(0,0,0,0.6);
  }

  .modal-content {
    background: #fff;
    margin: 8% auto;
    padding: 25px;
    border-radius: 12px;
    width: 90%;
    max-width: 600px;
    box-shadow: 0 6px 15px rgba(0,0,0,0.2);
    animation: fadeIn 0.3s ease-in-out;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(-20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .close-btn {
    float: right;
    font-size: 22px;
    font-weight: bold;
    color: #333;
    cursor: pointer;
  }

  .close-btn:hover {
    color: #ff3b30;
  }

  .modal h2 {
    margin-top: 0;
    color: #010A28;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
  }

  th, td {
    text-align: left;
    padding: 10px;
    border-bottom: 1px solid #eee;
  }

  th {
    width: 35%;
    background: #f9f9f9;
    font-weight: 600;
  }

  td {
    background: #fff;
  }
</style>

{% if notifications %}
  <ul class="notifications-list">
    {% for note in notifications %}
      <li class="notification-item" 
          onclick="openModal({{ note.id }})"
          data-id="{{ note.id }}"
          data-message="{{ note.message }}"
          data-timestamp="{{ note.timestamp|date:'M d, Y H:i' }}"
          {% if note.appointment %}
            data-client_name="{{ note.appointment.client_name }}"
            data-service="{{ note.appointment.service }}"
            data-date="{{ note.appointment.date }}"
            data-time="{{ note.appointment.time }}"
            data-job_location="{{ note.appointment.job_location }}"
            data-client_address="{{ note.appointment.client_address }}"
            data-house_number="{{ note.appointment.house_number }}"
            data-mobile="{{ note.appointment.mobile }}"
            data-email="{{ note.appointment.email }}"
          {% endif %}>
        <span class="notification-message">{{ note.message }}</span>
        <span class="notification-time">{{ note.timestamp|date:"M d, Y H:i" }}</span>
      </li>
    {% endfor %}
  </ul>
{% else %}
  <p>No notifications found.</p>
{% endif %}

<!-- Modal -->
<div id="notificationModal" class="modal">
  <div class="modal-content">
    <span class="close-btn" onclick="closeModal()">&times;</span>
    <h2>Notification Detail</h2>
    <p id="notifMessage"></p>
    <p><strong>Received:</strong> <span id="notifTime"></span></p>

    <div id="appointmentDetails" style="display:none;">
      <h3>Appointment Details</h3>
      <table>
        <tr><th>Client Name</th><td id="clientName"></td></tr>
        <tr><th>Service</th><td id="service"></td></tr>
        <tr><th>Date</th><td id="date"></td></tr>
        <tr><th>Time</th><td id="time"></td></tr>
        <tr><th>Job Location</th><td id="jobLocation"></td></tr>
        <tr><th>Client Address</th><td id="clientAddress"></td></tr>
        <tr><th>House No.</th><td id="houseNumber"></td></tr>
        <tr><th>Mobile</th><td id="mobile"></td></tr>
        <tr><th>Email</th><td id="email"></td></tr>
      </table>
    </div>

    <!-- Go to Job Button -->
    <div style="margin-top: 20px; text-align: right;">
      <button onclick="location.href='{% url 'verification_route' %}'"
              style="padding: 10px 18px; background-color:#010A28; color:#fff; border:none; border-radius:6px; cursor:pointer; font-size:14px;">
        Go to Job
      </button>
    </div>
  </div>
</div>


<script>
  function openModal(id) {
    const item = document.querySelector('[data-id="' + id + '"]');
    document.getElementById("notifMessage").innerText = item.dataset.message;
    document.getElementById("notifTime").innerText = item.dataset.timestamp;

    if (item.dataset.client_name) {
      document.getElementById("appointmentDetails").style.display = "block";
      document.getElementById("clientName").innerText = item.dataset.client_name;
      document.getElementById("service").innerText = item.dataset.service;
      document.getElementById("date").innerText = item.dataset.date;
      document.getElementById("time").innerText = item.dataset.time;
      document.getElementById("jobLocation").innerText = item.dataset.job_location;
      document.getElementById("clientAddress").innerText = item.dataset.client_address;
      document.getElementById("houseNumber").innerText = item.dataset.house_number;
      document.getElementById("mobile").innerText = item.dataset.mobile;
      document.getElementById("email").innerText = item.dataset.email;
    } else {
      document.getElementById("appointmentDetails").style.display = "none";
    }

    document.getElementById("notificationModal").style.display = "block";
  }

  function closeModal() {
    document.getElementById("notificationModal").style.display = "none";
  }

  window.onclick = function(event) {
    const modal = document.getElementById("notificationModal");
    if (event.target === modal) {
      modal.style.display = "none";
    }
  }
</script>

{% endblock %}
