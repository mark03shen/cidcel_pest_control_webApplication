{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>FAQs</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
    <div class="header">
        <div class="header-container">
            <div class="logo-text">
                <img id="logo" src="{% static 'cidsel_logo.png' %}" alt="CIDSEL Logo">
                <div class="text-group">
                    <h1>
                        <span class="brand">CIDSEL</span>
                        <span class="service">Pest Control Services</span>
                    </h1>
                    <p class="subtitle">Professional pest control for residential and commercial properties</p>
                </div>
            </div>

            <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                <a href="{% url 'book_appointment' %}" class="appointment-button">Book Appointment</a>
                
                {% if user.is_authenticated %}
                    <form method="post" action="{% url 'logout' %}">
                        {% csrf_token %}
                        <button type="submit" class="logout-button">Logout</button>
                    </form>
                {% endif %}

                {% if not user.is_authenticated %}
                    <div class="button-container dropdown">
                        <button class="dropdown-button">Sign In ‚ñº</button>
                        <div class="dropdown-content">
                            <a href="{% url 'login' %}">Sign In</a>
                            <a href="javascript:void(0);" onclick="openLoginOptions()">Admin Login</a>
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Login Modal -->
        <div id="loginModal" class="modal">
            <div class="modal-content">
            <span class="close" onclick="closeLoginOptions()">&times;</span>
            <h3>Select Login Type</h3>
            <a href="{% url 'admin_login' %}">
                <button class="modal-button admin">Admin Login</button>
            </a>
            <a href="{% url 'technician_login' %}">
                <button class="modal-button technician">Technician Login</button>
            </a>
            </div>
        </div>

    
        <div class="nav-bar">
            <a href="{% url 'dashboard' %}">Home</a>
            <a href="{% url 'services' %}">Services</a>
            <a href="{% url 'faqs' %}">FAQs</a>

            {% if user.is_authenticated %}
                <a href="{% url 'feedback' %}">Feedback</a>
            {% else %}
                <div class="tooltip-wrapper">
                    <a href="{% url 'login' %}" class="tooltip-link">Feedback</a>
                    <span class="tooltip-text">Need to Sign In</span>
                </div>
            {% endif %}

            {% if user.is_authenticated %}
                <a href="{% url 'profile' %}">Profile</a>
            {% else %}
                <div class="tooltip-wrapper">
                    <a href="{% url 'login' %}" class="tooltip-link">Profile</a>
                    <span class="tooltip-text">Need to Sign In</span>
                </div>
            {% endif %}
        </div>

    </div>

<div class="content">
    <h2 style="margin-top: 60px; text-align: center;">Frequently Asked Questions</h2>

    <div style="max-width: 800px; margin: 0 auto; padding: 20px;">
        
        <!-- FAQ 1 -->
        <div style="margin-bottom: 20px; border-bottom: 1px solid #ddd; padding-bottom: 15px;">
            <h4 style="cursor: pointer;" onclick="toggleFaq(this)">What is included in the General Pest Control service? <span style="float: right;">&#9660;</span></h4>
            <p style="display: none; font-size: 14px; color: #333;">
                Our General Pest Control includes customized treatment plans for insects and pests, rodent control solutions, preventative sealing, scheduled follow-up visits, and a free initial inspection.
            </p>
        </div>

        <!-- FAQ 2 -->
        <div style="margin-bottom: 20px; border-bottom: 1px solid #ddd; padding-bottom: 15px;">
            <h4 style="cursor: pointer;" onclick="toggleFaq(this)">What does a free inspection involve? <span style="float: right;">&#9660;</span></h4>
            <p style="display: none; font-size: 14px; color: #333;">
                A technician will inspect your property for pest activity, signs of infestation, moisture problems, and entry points ‚Äî providing a no-obligation assessment and recommended action plan.
            </p>
        </div>

        <!-- FAQ 3 -->
        <div style="margin-bottom: 20px; border-bottom: 1px solid #ddd; padding-bottom: 15px;">
            <h4 style="cursor: pointer;" onclick="toggleFaq(this)">How often are follow-up visits done? <span style="float: right;">&#9660;</span></h4>
            <p style="display: none; font-size: 14px; color: #333;">
                Follow-up visits are typically scheduled every 2‚Äì4 weeks depending on the pest type and severity. These ensure ongoing protection and allow us to adjust treatments if necessary.
            </p>
        </div>

        <!-- FAQ 4 -->
        <div style="margin-bottom: 20px; border-bottom: 1px solid #ddd; padding-bottom: 15px;">
            <h4 style="cursor: pointer;" onclick="toggleFaq(this)">Are the chemicals you‚Äôre using considered toxic or low-impact formulations? <span style="float: right;">&#9660;</span></h4>
            <p style="display: none; font-size: 14px; color: #333;">
                The chemicals used in our services are low-impact and not harmful to humans, pets, or the environment.
            </p>
        </div>

        <!-- FAQ 5 -->
        <div style="margin-bottom: 20px; border-bottom: 1px solid #ddd; padding-bottom: 15px;">
            <h4 style="cursor: pointer;" onclick="toggleFaq(this)">How is Termite Comprehensive different from Spot Treatment? <span style="float: right;">&#9660;</span></h4>
            <p style="display: none; font-size: 14px; color: #333;">
                Termite Comprehensive is a full-scale solution including colony elimination, mound demolition, and broad inspection. Spot Treatment targets isolated infestations with localized application for quick, focused results.
            </p>
        </div>

        <!-- FAQ 6 -->
        <div style="margin-bottom: 20px; border-bottom: 1px solid #ddd; padding-bottom: 15px;">
            <h4 style="cursor: pointer;" onclick="toggleFaq(this)">Is pest control safe for children and pets? <span style="float: right;">&#9660;</span></h4>
            <p style="display: none; font-size: 14px; color: #333;">
                Yes. We use family- and pet-safe products approved by health and environmental standards. Our team ensures treatments are applied responsibly, with guidance provided before and after visits.
            </p>
        </div>

        <!-- FAQ 7 -->
        <div style="margin-bottom: 20px; border-bottom: 1px solid #ddd; padding-bottom: 15px;">
            <h4 style="cursor: pointer;" onclick="toggleFaq(this)">How long does a typical treatment take? <span style="float: right;">&#9660;</span></h4>
            <p style="display: none; font-size: 14px; color: #333;">
                reatment time varies depending on the area and type of service. For General Pest Control, it usually takes 30 minutes to 1 hour per visit. Termite Comprehensive treatments may take 2 to 3 hours, while Termite Spot Treatment typically lasts 1 to 2 hours, depending on the visit.
            </p>
        </div>
    </div>

{% if user.is_authenticated %}
<div class="chat-btn-wrapper">
  <span id="chatNotification" class="chat-notification">!</span>
  <button id="chatBtn" class="chat-button" onclick="openChat()">üí¨ Message Admin</button>
</div>
{% else %}
<div class="chat-btn-wrapper">
  <button id="chatBtn" class="chat-button disabled" title="Login to chat" disabled>üí¨ Login to Chat</button>
</div>
{% endif %}

<!-- Chat Modal -->
<div id="chatModal" class="chat-modal">
  <div class="chat-modal-content">
    <span class="close-chat" onclick="closeChat()">&times;</span>
    <h2>Chat with Admin</h2>
    <div id="chatMessages" class="chat-messages"></div>
    <form id="chatForm">
      <input type="text" id="chatInput" placeholder="Type your message..." required>
      <button type="submit">Send</button>
    </form>
  </div>
</div> 

<button id="backToTop" title="Go to top">ü¢Å</button>

</div>

<!-- Toggle Script -->
<script>
    function toggleFaq(header) {
        const paragraph = header.nextElementSibling;
        const icon = header.querySelector('span');
        if (paragraph.style.display === "block") {
            paragraph.style.display = "none";
            icon.innerHTML = "&#9660;";
        } else {
            paragraph.style.display = "block";
            icon.innerHTML = "&#9650;";
        }
    }

    // this is for adminTechnician login modals
    setTimeout(() => {
        document.body.classList.add("loaded");
    }, 3000);

    function openLoginOptions() {
        document.getElementById("loginModal").style.display = "block";
    }

    function closeLoginOptions() {
        document.getElementById("loginModal").style.display = "none";
    }

    window.onclick = function(event) {
        const modal = document.getElementById("loginModal");
        if (event.target === modal) {
        modal.style.display = "none";
        }
    }

    // to fix nav bar on top when scrolling
    window.addEventListener("scroll", function() {
        const nav = document.querySelector(".nav-bar");
        const header = document.querySelector(".header");

        if (window.scrollY >= header.offsetHeight) {
            nav.classList.add("fixed-nav");
        } else {
            nav.classList.remove("fixed-nav");
        }
    });

    // Back to Top button functionality
const backToTop = document.getElementById("backToTop");

window.onscroll = function () {
  if (document.body.scrollTop > 200 || document.documentElement.scrollTop > 200) {
    backToTop.style.display = "block";
  } else {
    backToTop.style.display = "none";
  }
};

backToTop.onclick = function () {
  window.scrollTo({ top: 0, behavior: "smooth" });
};

// Chat system
function openChat() {
  document.getElementById("chatModal").style.display = "block";
  loadMessages();
}

function closeChat() {
  document.getElementById("chatModal").style.display = "none";
}

async function loadMessages() {
  const res = await fetch("{% url 'load_messages' %}");
  const data = await res.json();
  const container = document.getElementById("chatMessages");
  container.innerHTML = "";
  data.messages.forEach(m => {
    const msgDiv = document.createElement("div");
    msgDiv.className = m.is_admin ? "admin-msg" : "user-msg";
    msgDiv.textContent = `${m.sender}: ${m.message}`;
    container.appendChild(msgDiv);
  });
  container.scrollTop = container.scrollHeight;
}

// Refresh messages every 5s
setInterval(loadMessages, 5000);

document.getElementById("chatForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const msg = document.getElementById("chatInput").value;
  await fetch("{% url 'send_message' %}", {
    method: "POST",
    headers: { "X-CSRFToken": "{{ csrf_token }}" },
    body: new URLSearchParams({ message: msg })
  });
  document.getElementById("chatInput").value = "";
  loadMessages();
});

// Close modal when clicking outside
window.addEventListener("click", function (event) {
  const modal = document.getElementById("chatModal");
  if (event.target === modal) {
    closeChat();
  }
});


//chat notif
let lastMessageCount = 0;
const chatBadge = document.getElementById("chatNotification");

async function checkNewMessages() {
  const res = await fetch("{% url 'load_messages' %}");
  const data = await res.json();
  const messages = data.messages;

  // Count admin messages
  const adminMessages = messages.filter(m => m.is_admin);

  // If new admin message arrived, show "!"
  if (adminMessages.length > lastMessageCount && document.getElementById("chatModal").style.display !== "block") {
    chatBadge.style.display = "block";
  }

  lastMessageCount = adminMessages.length;
}

setInterval(checkNewMessages, 5000);

// Hide badge when chat is opened
function openChat() {
  document.getElementById("chatModal").style.display = "block";
  chatBadge.style.display = "none";
  loadMessages();
}

document.addEventListener("DOMContentLoaded", () => {
  const chatModal = document.getElementById("chatModal");
  const chatBadge = document.getElementById("chatNotification");
  let lastMessageCount = 0;

  async function checkNewMessages() {
    try {
      const res = await fetch("{% url 'load_messages' %}");
      const data = await res.json();
      const adminMessages = data.messages.filter(m => m.is_admin);

      // Show badge only if modal is closed and new message appears
      if (adminMessages.length > lastMessageCount && chatModal.style.display !== "block") {
        chatBadge.style.display = "block";
      }
      lastMessageCount = adminMessages.length;
    } catch (err) {
      console.error("Message check failed:", err);
    }
  }

  setInterval(checkNewMessages, 2000);

  // Wrap the existing openChat to hide badge when chat opens
  window.openChat = function() {
    chatModal.style.display = "block";
    chatBadge.style.display = "none";
    loadMessages();
  };

  window.closeChat = function() {
    chatModal.style.display = "none";
  };

  // Close modal on outside click
  window.addEventListener("click", (event) => {
    if (event.target === chatModal) {
      closeChat();
    }
  });
});

</script>

</body>

<footer class="site-footer">
  <div class="footer-container">
    <!-- Quick Contact -->
    <div class="footer-section">
      <h2>Quick Contact</h2>
      <p>Email: <a href="mailto:cidselpestcontrol@gmail.com">cidselpestcontrol@gmail.com</a></p>
      <p><strong>Phone</strong></p>
      <ul>
        <li>0948-285-7626</li>
        <li>0939-135-7361</li>
        <li>0998-576-4850</li>
      </ul>
    </div>

    <!-- Location -->
    <div class="footer-section">
      <h2>Our Location</h2>
      <p>
        Purok 7, Sampaloc Santo Cristo, <br>
        Sariaya, Philippines, 4322
      </p>
    </div>
  </div>

  <div class="footer-bottom">
    <p>&copy; {{ now|date:"Y" }} CIDSEL Pest Control Services. All Rights Reserved.</p>
  </div>
</footer>


<style>
    * {
        box-sizing: border-box;
    }

    body {
        font-family: 'Segoe UI', sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f5f5f5;
    }

    img {
        max-width: 100%;
        height: auto;
    }

    .header {
        background-color: #010A28;
        color: white;
        padding: 10px 0;
        position: relative;
        top: 0;
        width: 100%;
        z-index: 1000;
    }

    .header-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        align-items: center;
        padding: 10px 20px;
    }

    .logo-text {
        display: flex;
        align-items: center;
        gap: 15px;
        flex-wrap: wrap;
    }

    #logo {
        width: 60px;
        height: 60px;
        border-radius: 50%;
    }

    .text-group {
        text-align: left;
    }

    .brand {
        color: white;
        font-weight: bold;
        font-size: 22px;
    }

    .service {
        color: #DDAA1E;
        font-weight: bold;
        font-size: 22px;
    }

    .subtitle {
        color: #ccc;
        margin-top: 4px;
        font-size: 14px;
    }

    .logout-button,
    .appointment-button {
        background-color: #DDAA1E;
        color: #010A28;
        font-weight: bold;
        border: none;
        padding: 8px 15px;
        border-radius: 5px;
        cursor: pointer;
        margin: 5px;
        text-decoration: none;
        white-space: nowrap;
    }

    .logout-button:hover,
    .appointment-button:hover {
        background-color: #c2941a;
    }

    .nav-bar {
        display: flex;
        justify-content: center;
        gap: 15px;
        padding: 10px;
        flex-wrap: wrap;
    }

    .fixed-nav {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        background: #010A28;
        z-index: 999;
    }

    .nav-bar a {
        text-decoration: none;
        color: #f5f5f5;
        font-weight: bold;
        padding: 5px 22px;
        border-radius: 5px;
        transition: background 0.2s;
    }

    .nav-bar a.active,
    .nav-bar a:hover {
        background-color: #DDAA1E;
        color: #fff;
    }

    .tooltip-wrapper {
        position: relative;
        display: inline-block;
    }

    .tooltip-text {
        visibility: hidden;
        background-color: #333;
        color: #fff;
        text-align: center;
        border-radius: 4px;
        padding: 5px 8px;
        position: absolute;
        z-index: 1;
        bottom: 125%; /* position above the link */
        left: 50%;
        transform: translateX(-50%);
        opacity: 0;
        transition: opacity 1s;
        white-space: nowrap;
    }

    .tooltip-wrapper:hover .tooltip-text {
        visibility: visible;
        opacity: 1;
    }

    .tooltip-link {
        text-decoration: none;
        color: #f5f5f5;
        font-weight: bold;
        padding: 5px 10px;
        border-radius: 5px;
        transition: background 0.2s;
    }

    .tooltip-link:hover {
        background-color: #DDAA1E;
        color: #fff;
    }


    /* Mobile Styles */
    @media (max-width: 768px) {
        .header-container {
            flex-direction: column;
            align-items: flex-start;
            gap: 10px;
        }

        .logo-text {
            flex-direction: column;
            align-items: center;
            text-align: center;
            width: 100%;
        }

        .text-group {
            text-align: center;
        }

        .brand, .service {
            font-size: 20px;
        }

        .subtitle {
            font-size: 12px;
        }

        .logout-button,
        .appointment-button {
            width: 100%;
            text-align: center;
        }

        .nav-bar {
            flex-direction: column;
            align-items: center;
        }

        .nav-bar a {
            width: 100%;
            max-width: 200px;
            text-align: center;
        }
    }

    /* Modal styles */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.4);
    }

    .modal-content {
      background-color: #fff;
      margin: 20% auto;
      padding: 20px;
      border-radius: 10px;
      width: 90%;
      max-width: 350px;
      text-align: center;
      position: relative;
      border: 2px solid #DDAA1E;
    }

    .close {
      color: #aaa;
      position: absolute;
      right: 15px;
      top: 10px;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
    }

    .close:hover {
      color: black;
    }

    .modal-button {
      display: block;
      width: 100%;
      margin: 10px 0;
      padding: 10px;
      font-size: 16px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    .modal-button.admin {
      background-color: #010A28;
      color: white;
    }

    .modal-button.technician {
      background-color: #DDAA1E;
      color: #010A28;
    }

    .modal-button:hover {
      opacity: 0.85;
    }


    /* Dropdown styles */
.dropdown {
    position: relative;
    display: inline-block;
}

.dropdown-button {
    background-color: #010A28;
    color: #fff;
    padding: 10px 20px;
    font-size: 16px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}

.dropdown-button:hover {
    background-color: #DDAA1E;
    color: #010A28;
}

.dropdown-content {
    display: none;
    position: absolute;
    background-color: #f9f9f9;
    min-width: 160px;
    box-shadow: 0px 8px 16px rgba(0,0,0,0.2);
    z-index: 1001;
    border-radius: 5px;
    overflow: hidden;
    margin-top: 5px;
}

.dropdown-content a {
    color: #010A28;
    padding: 10px 15px;
    text-decoration: none;
    display: block;
    font-weight: bold;
}

.dropdown-content a:hover {
    background-color: #DDAA1E;
    color: white;
}

/* Show dropdown on hover */
.dropdown:hover .dropdown-content {
    display: block;
}

/*FOOTER*/
.site-footer {
    background-color: #010A28;
    color: white;
    padding: 40px 20px 20px;
    margin-top: 50px;
}

.footer-container {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    gap: 40px;
    max-width: 1200px;
    margin: 0 auto;
}

.footer-section {
    flex: 1;
    min-width: 250px;
}

.footer-section h2 {
    color: #DDAA1E;
    font-size: 20px;
    margin-bottom: 10px;
}

.footer-section p,
.footer-section ul {
    margin: 5px 0;
    font-size: 15px;
}

.footer-section ul {
    list-style: none;
    padding: 0;
}

.footer-section ul li {
    margin: 3px 0;
}

.footer-section a {
    color: #DDAA1E;
    text-decoration: none;
}

.footer-section a:hover {
    text-decoration: underline;
}

.footer-bottom {
    text-align: center;
    border-top: 1px solid #444;
    margin-top: 30px;
    padding-top: 15px;
    font-size: 14px;
    color: #bbb;
}

/* Back to Top Button */
#backToTop {
  position: fixed;
  bottom: 20px;
  right: 20px;
  z-index: 5000; /* above all content */
  background-color: #010A28;
  color: white;
  border: none;
  padding: 12px 16px;
  border-radius: 50%;
  font-size: 20px;
  cursor: pointer;
  opacity: 0.5; /* 50% transparent */
  transition: opacity 0.3s ease, transform 0.3s ease;
}

#backToTop:hover {
  opacity: 0.9;
  transform: scale(1.1);
}

/* for chat system*/
.chat-button {
  position: fixed;
  bottom: 75px;
  right: 20px;
  background: #DDAA1E;
  color: #010A28;
  padding: 16px 20px;
  border: none;
  border-radius: 50px;
  cursor: pointer;
  font-weight: bold;
  opacity: 80%;
}
.chat-button.disabled {
  background: #ccc;
  cursor: not-allowed;
  opacity: 80%;
}

.chat-modal {
  display: none;
  position: fixed;
  z-index: 2000;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.4);
}
.chat-modal-content {
  background: #fff;
  margin: 10% auto;
  padding: 20px;
  max-width: 400px;
  border-radius: 12px;
  box-shadow: 0 0 15px rgba(0,0,0,0.2);
}
.chat-messages {
  height: 300px;
  overflow-y: auto;
  background: #f9f9f9;
  padding: 10px;
  margin-bottom: 10px;
}
.user-msg {
  text-align: right;
  background: #DDAA1E;
  color: white;
  margin: 5px;
  padding: 8px 12px;
  border-radius: 10px 10px 0 10px;
}
.admin-msg {
  text-align: left;
  background: #eee;
  margin: 5px;
  padding: 8px 12px;
  border-radius: 10px 10px 10px 0;
}

.chat-btn-wrapper {
  position: fixed;
  bottom: 145px;
  right: 20px;
}

.chat-notification {
  position: absolute;
  top: 5px;
  right: 10px;
  background: red;
  color: white;
  font-weight: bold;
  border-radius: 50%;
  width: 18px;
  height: 18px;
  font-size: 12px;
  text-align: center;
  line-height: 18px;
  display: none; /* hidden by default */
  box-shadow: 0 0 5px rgba(0,0,0,0.3);
}

</style>
</html>